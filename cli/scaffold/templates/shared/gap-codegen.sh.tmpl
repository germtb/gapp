#!/bin/bash
# Codegen script for <<.Name>>
# Runs protoc and preload config generation

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Find the gap codegen script relative to this project
# Adjust this path based on your gap framework location
GAP_CODEGEN="${SCRIPT_DIR}/../gap/codegen/codegen.sh"

if [[ ! -f "$GAP_CODEGEN" ]]; then
  echo "Error: gap codegen script not found at $GAP_CODEGEN"
  echo "Please set the GAP_CODEGEN path to your gap framework's codegen.sh"
  exit 1
fi

"$GAP_CODEGEN" \
  --proto "$SCRIPT_DIR/proto/service.proto" \
  --go-out "$SCRIPT_DIR/server/generated" \
  --ts-out "$SCRIPT_DIR/client/src/generated" \
  --routes-dir "$SCRIPT_DIR/client/src/routes" \
  --preload-out "$SCRIPT_DIR/server/generated/preload_routes.go"
